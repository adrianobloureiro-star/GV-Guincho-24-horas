<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Guincho GV 24 Horas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px; }

    .container{
      max-width:1100px; margin:auto; background:#fff; padding:20px;
      border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.1);
    }

    /* ===== AJUSTE: T√çTULO (Guincho GV + 24 Horas em vermelho, maior, sublinhado) ===== */
    .titulo{
      text-align:center;
      font-size:40px;
      margin:0 0 6px 0;
      font-weight:800;
      text-decoration: underline;
    }
    .titulo .vermelho{ color:#c00000; }

    .logo{ text-align:center; margin:0; line-height:0; }
    .logo img{ display:block; margin:0 auto; max-width:260px; width:100%; height:auto; }

    h2{ text-align:center; margin:10px 0 15px 0; }

    .linha{ display:flex; gap:10px; flex-wrap:wrap; }
    input{
      flex:1; min-width:260px; padding:12px; font-size:16px;
      border:1px solid #cfd6dd; border-radius:8px;
    }

    /* ===== BOT√ïES ===== */
    .botoes{
      display:flex; gap:12px; justify-content:center; align-items:center;
      flex-wrap:wrap; margin-top:12px;
    }
    .botoes button{
      flex: 0 1 220px;
      padding:12px;
      font-size:16px;
      border:none;
      border-radius:10px;
      color:#fff;
      cursor:pointer;
      width:auto;
      max-width:220px;
    }

    /* AJUSTE: no celular, 3 bot√µes por linha (quando couber) */
    @media (max-width: 520px){
      body{ padding:12px; }
      .container{ padding:14px; }

      .botoes{ gap:10px; }
      .botoes button{
        flex: 1 1 calc(33.333% - 10px);
        max-width:none;
        padding:12px 8px;
        font-size:14px;
      }

      .titulo{ font-size:32px; }
      input{ min-width:100%; }

      /* seletor em 1 coluna no celular */
      .selectors-grid{ grid-template-columns: 1fr; }
    }

    .btn-azul{ background:#1a73e8; } .btn-azul:hover{ background:#1558b0; }
    .btn-verde{ background:#16a34a; } .btn-verde:hover{ background:#15803d; }
    .btn-cinza{ background:#344054; } .btn-cinza:hover{ background:#1f2937; }
    .btn-wpp{ background:#25D366; } .btn-wpp:hover{ background:#1fb457; }

    #resultado{
      margin-top:15px; padding:12px; background:#f9f9f9;
      border-radius:10px; border:1px solid #e1e5ea;
    }
    .erro{ color:#c00000; }
    .muted{ color:#6b7280; font-size:13px; margin-top:6px; }

    #map{ margin-top:15px; height:420px; border-radius:12px; overflow:hidden; }

    footer{ margin-top:25px; text-align:center; font-size:14px; color:#666; }
    footer b{ color:#000; }

    /* ===== AJUSTE: SELETORES EM BOT√ïES (abaixo dos bot√µes principais) ===== */
    .selectors{
      margin-top:14px;
      padding:12px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:#fafafa;
    }
    .selectors h3{
      margin:0 0 10px 0;
      font-size:16px;
    }
    .required-badge{
      color:#c00000;
      font-weight:900;
    }
    .selectors-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .selector-card{
      padding:12px;
      border:1px solid #e5e7eb;
      border-radius:12px;
      background:#fff;
    }
    .selector-label{
      font-weight:900;
      margin:0 0 10px 0;
    }

    .selector-options{
      display:flex;
      gap:10px;
      flex-wrap:nowrap;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom:4px;
    }
    .selector-options::-webkit-scrollbar { height: 6px; }
    .selector-options::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 999px; }
    .selector-options::-webkit-scrollbar-track { background: transparent; }

    .opt-btn{
      border:1px solid #d1d5db;
      background:#fff;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      transition: transform .03s ease, background .15s ease, border-color .15s ease, color .15s ease;
      user-select:none;
      white-space:nowrap;
      flex: 0 0 auto;
    }
    .opt-btn:active{ transform: scale(0.98); }

    .opt-btn.vehicle{ border-color:#b9d3ff; color:#1558b0; }
    .opt-btn.vehicle.selected{ background:#1a73e8; border-color:#1a73e8; color:#fff; }

    .opt-btn.situacao{ border-color:#ffc2c2; color:#a80000; }
    .opt-btn.situacao.selected{ background:#c00000; border-color:#c00000; color:#fff; }

    @media (max-width: 520px){
      .selector-options{
        flex-wrap:wrap;
        overflow-x:visible;
        padding-bottom:0;
      }
      .opt-btn{
        flex: 1 1 calc(50% - 10px);
        text-align:center;
      }
    }

    /* Modal */
    .modal{
      display:none; position:fixed; inset:0; background:rgba(0,0,0,.5);
      justify-content:center; align-items:center; padding:16px;
    }
    .modal-content{
      background:#fff; width:100%; max-width:420px; border-radius:12px;
      padding:18px; box-shadow:0 8px 30px rgba(0,0,0,.2);
    }
    .modal-content h3{ margin:0 0 10px 0; }
    .modal-content input{ width:100%; min-width:0; margin-top:10px; }
    .modal-actions{ display:flex; gap:10px; margin-top:12px; }
    .modal-actions button{ flex:1; width:auto; }
  </style>
</head>

<body>
  <div class="container">
    <div class="titulo">
      Guincho GV <span class="vermelho">24 Horas</span>
    </div>

    <div class="logo">
      <img src="logo-gv-guincho.png" alt="GV Guincho" />
    </div>

    <h2>Calcular a Rota, Tempo e Valor do seu Guincho</h2>

    <!-- 1) CAMPOS DE ENDERE√áO -->
    <div class="linha">
      <input id="origem" placeholder="Endere√ßo de origem" />
      <input id="destino" placeholder="Endere√ßo de destino" />
    </div>

    <!-- 2) BOT√ïES PRINCIPAIS -->
    <div class="botoes">
      <button class="btn-verde" id="btnLocalizacao">üìç Minha localiza√ß√£o</button>
      <button class="btn-cinza" id="btnInverter">üîÅ Inverter</button>
      <button class="btn-wpp" id="btnWhats">üí¨ WhatsApp</button>
    </div>

    <!-- 3) SELETORES -->
    <div class="selectors">
      <h3>Selecione as op√ß√µes <span class="required-badge">(obrigat√≥rio)</span></h3>

      <div class="selectors-grid">
        <div class="selector-card">
          <div class="selector-label">Tipo de ve√≠culo <span class="required-badge">*</span></div>
          <div class="selector-options">
            <button type="button" class="opt-btn vehicle" data-group="veiculo" data-value="Carro pequeno">Carro pequeno</button>
            <button type="button" class="opt-btn vehicle" data-group="veiculo" data-value="SUV">SUV</button>
            <button type="button" class="opt-btn vehicle" data-group="veiculo" data-value="Vans">Vans</button>
            <button type="button" class="opt-btn vehicle" data-group="veiculo" data-value="Moto">Moto</button>
          </div>
        </div>

        <div class="selector-card">
          <div class="selector-label">Tipo de situa√ß√£o <span class="required-badge">*</span></div>
          <div class="selector-options">
            <button type="button" class="opt-btn situacao" data-group="situacao" data-value="Pane">Pane</button>
            <button type="button" class="opt-btn situacao" data-group="situacao" data-value="Bateria">Bateria</button>
            <button type="button" class="opt-btn situacao" data-group="situacao" data-value="Pneu">Pneu</button>
            <button type="button" class="opt-btn situacao" data-group="situacao" data-value="Acidente">Acidente</button>
          </div>
        </div>
      </div>

      <div class="muted">
        Essas op√ß√µes v√£o no or√ßamento e na mensagem do WhatsApp.
      </div>
    </div>

    <!-- 4) CALCULAR -->
    <div class="botoes">
      <button class="btn-azul" id="btnCalcular">Calcular</button>
    </div>

    <div id="resultado">
      Preencha os endere√ßos, selecione as op√ß√µes e clique em <b>Calcular</b>.
      <div class="muted">Dica: clique em <b>üìç Minha localiza√ß√£o</b> para preencher a origem automaticamente.</div>
    </div>

    <div id="map"></div>

    <footer>
      Desenvolvido por <b>Braztec</b> | Contato: <b>27 99836-1919</b>
    </footer>
  </div>

  <!-- Modal Nome -->
  <div class="modal" id="modalNome">
    <div class="modal-content">
      <h3>Digite seu nome</h3>
      <input type="text" id="nomeCliente" placeholder="Seu nome" />
      <div class="modal-actions">
        <button class="btn-cinza" id="btnCancelar">Cancelar</button>
        <button class="btn-azul" id="btnEnviar">Enviar</button>
      </div>
      <div class="muted">O telefone ser√° o do seu WhatsApp ao enviar a mensagem.</div>
    </div>
  </div>

  <script>
    /*
      ============================
      AJUSTES DESTA VERS√ÉO:
      1) L√ìGICA DE PRE√áO:
         TOTAL = TARIFA_BASE + (KM * VALOR_POR_KM * MULTIPLICADOR_VEICULO) + TAXA_SITUACAO + ADICIONAL_NOTURNO(se aplic√°vel)

      2) ADICIONAL NOTURNO:
         - Aplica entre 22:00 e 06:00
         - Controlado por vari√°veis

      3) WHATSAPP:
         - Se N√ÉO houver c√°lculo (sem origem/destino), abre direto a conversa pedindo or√ßamento com atendente (sem modal).
         - Se houver c√°lculo atualizado, abre modal para nome e envia mensagem estruturada com or√ßamento.
         - SEMPRE envia a localiza√ß√£o atual (se dispon√≠vel), com ou sem c√°lculo.

      4) AUTOCOMPLETE:
         - Places autocomplete s√≥ inicia ap√≥s 3 letras digitadas.
      ============================
    */

    let map, directionsService, directionsRenderer, geocoder;

    // ======= PRE√áOS BASE =======
    let TARIFA_BASE = 180.00;
    let VALOR_POR_KM = 5.00;

    // ======= ADICIONAL NOTURNO (22:00 √†s 06:00) =======
    const ADICIONAL_NOTURNO = 50.00;
    const HORA_INICIO_NOTURNO = 22;
    const HORA_FIM_NOTURNO = 6;

    function emHorarioNoturno(data = new Date()) {
      const h = data.getHours();
      return (h >= HORA_INICIO_NOTURNO) || (h < HORA_FIM_NOTURNO);
    }

    // ======= MULTIPLICADOR POR VE√çCULO =======
    const MULTIPLICADOR_VEICULO = {
      "Carro pequeno": 1.0,
      "Vans": 1.3,
      "SUV": 1.2,
      "Moto": 0.8
    };

    // ======= TAXA POR SITUA√á√ÉO =======
    const TAXA_SITUACAO = {
      "Pane": 0,
      "Bateria": 0,
      "Pneu": 0,
      "Acidente": 0
    };

    // ======= WHATSAPP =======
    const WHATSAPP_NUMERO = "5527995993430";

    // √öltimo c√°lculo (quando houver)
    let ultimoResumo = null;

    // √öltima localiza√ß√£o capturada pelo üìç (lat/lng)
    let ultimaLocalizacao = null;

    // Sele√ß√µes (bot√µes)
    let selecaoVeiculo = "";
    let selecaoSituacao = "";

    // Snapshot do estado no momento do √∫ltimo c√°lculo
    let ultimoSnapshot = null;

    // Autocomplete (iniciar somente ap√≥s 3 letras)
    let acOrigem = null;
    let acDestino = null;
    let acOrigemIniciado = false;
    let acDestinoIniciado = false;

    function brl(v) {
      return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
    }

    function setResultado(html) {
      document.getElementById("resultado").innerHTML = html;
    }

    function validarSelecoesOuAvisar() {
      if (!selecaoVeiculo || !selecaoSituacao) {
        setResultado("<span class='erro'>Selecione <b>Tipo de ve√≠culo</b> e <b>Tipo de situa√ß√£o</b> antes de continuar.</span>");
        return false;
      }
      return true;
    }

    function snapshotAtual() {
      return {
        origem: document.getElementById("origem").value.trim(),
        destino: document.getElementById("destino").value.trim(),
        veiculo: selecaoVeiculo,
        situacao: selecaoSituacao
      };
    }

    function mudouDesdeUltimoCalculo() {
      if (!ultimoSnapshot) return true;
      const s = snapshotAtual();
      return (
        s.origem !== ultimoSnapshot.origem ||
        s.destino !== ultimoSnapshot.destino ||
        s.veiculo !== ultimoSnapshot.veiculo ||
        s.situacao !== ultimoSnapshot.situacao
      );
    }

    function initSelectors() {
      document.querySelectorAll(".opt-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const group = btn.dataset.group;
          const value = btn.dataset.value;

          if (group === "veiculo") {
            selecaoVeiculo = value;
            document.querySelectorAll(".opt-btn.vehicle").forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");
          } else if (group === "situacao") {
            selecaoSituacao = value;
            document.querySelectorAll(".opt-btn.situacao").forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");
          }

          ultimoResumo = null;
          ultimoSnapshot = null;
        });
      });

      document.getElementById("origem").addEventListener("input", () => { ultimoResumo = null; ultimoSnapshot = null; });
      document.getElementById("destino").addEventListener("input", () => { ultimoResumo = null; ultimoSnapshot = null; });
    }

    function initAutocompleteApos3Letras() {
      const origemInput = document.getElementById("origem");
      const destinoInput = document.getElementById("destino");

      const options = { types: ["geocode"], componentRestrictions: { country: "br" } };

      origemInput.addEventListener("input", () => {
        if (!acOrigemIniciado && origemInput.value.trim().length >= 3) {
          acOrigem = new google.maps.places.Autocomplete(origemInput, options);
          acOrigemIniciado = true;
        }
      });

      destinoInput.addEventListener("input", () => {
        if (!acDestinoIniciado && destinoInput.value.trim().length >= 3) {
          acDestino = new google.maps.places.Autocomplete(destinoInput, options);
          acDestinoIniciado = true;
        }
      });
    }

    function initMap() {
      initSelectors();

      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -20.3155, lng: -40.3128 },
        zoom: 12
      });

      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({ map });
      geocoder = new google.maps.Geocoder();

      initAutocompleteApos3Letras();

      document.getElementById("btnLocalizacao").addEventListener("click", usarMinhaLocalizacao);
      document.getElementById("btnInverter").addEventListener("click", inverter);

      document.getElementById("btnCalcular").addEventListener("click", () => {
        calcularRota({ abrirModalDepois: false });
      });

      document.getElementById("btnWhats").addEventListener("click", abrirWhatsComDadosAtualizados);

      document.getElementById("btnCancelar").addEventListener("click", fecharModal);
      document.getElementById("btnEnviar").addEventListener("click", enviarWhats);

      document.getElementById("destino").addEventListener("keydown", (e) => {
        if (e.key === "Enter") calcularRota({ abrirModalDepois: false });
      });

      tentarLocalizacaoAutomatica();
    }

    async function tentarLocalizacaoAutomatica() {
      try {
        if (!navigator.geolocation) return;

        if (navigator.permissions?.query) {
          const p = await navigator.permissions.query({ name: "geolocation" });

          if (p.state === "granted" || p.state === "prompt") {
            usarMinhaLocalizacao();
          }
          return;
        }

        usarMinhaLocalizacao();
      } catch (_) {}
    }

    function usarMinhaLocalizacao() {
      if (!navigator.geolocation) {
        setResultado("<span class='erro'>Seu navegador n√£o suporta geolocaliza√ß√£o.</span>");
        return;
      }

      setResultado("Obtendo sua localiza√ß√£o‚Ä¶");

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const latlng = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          ultimaLocalizacao = latlng;

          map.setCenter(latlng);
          map.setZoom(15);

          geocoder.geocode({ location: latlng }, (results, status) => {
            if (status === "OK" && results && results.length) {
              document.getElementById("origem").value = results[0].formatted_address;
              setResultado("Origem preenchida com sua localiza√ß√£o. Agora informe o destino e clique em <b>Calcular</b>.");
            } else {
              document.getElementById("origem").value = `${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}`;
              setResultado("Localiza√ß√£o obtida, mas n√£o foi poss√≠vel converter para endere√ßo. Preenchemos com coordenadas.");
            }
          });

          ultimoResumo = null;
          ultimoSnapshot = null;
        },
        (err) => {
          const msg =
            err.code === 1 ? "Permiss√£o negada. Clique em üìç e permita a localiza√ß√£o." :
            err.code === 2 ? "N√£o foi poss√≠vel obter sua localiza√ß√£o (sinal fraco). Tente novamente." :
            "N√£o foi poss√≠vel obter sua localiza√ß√£o. Tente novamente.";
          setResultado(`<span class='erro'>${msg}</span>`);
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    }

    function inverter() {
      const o = document.getElementById("origem");
      const d = document.getElementById("destino");
      const tmp = o.value;
      o.value = d.value;
      d.value = tmp;

      ultimoResumo = null;
      ultimoSnapshot = null;
    }

    function calcularRota({ abrirModalDepois } = {}) {
      if (!validarSelecoesOuAvisar()) return;

      const origem = document.getElementById("origem").value.trim();
      const destino = document.getElementById("destino").value.trim();

      if (!origem || !destino) {
        setResultado("<span class='erro'>Informe origem e destino.</span>");
        return;
      }

      const taxaSituacao = TAXA_SITUACAO[selecaoSituacao] ?? 0;

      directionsService.route(
        {
          origin: origem,
          destination: destino,
          travelMode: google.maps.TravelMode.DRIVING
        },
        (response, status) => {
          if (status !== "OK" || !response?.routes?.length) {
            setResultado(`<span class='erro'>Erro ao calcular rota. (${status})</span>`);
            return;
          }

          directionsRenderer.setDirections(response);

          const rota = response.routes[0].legs[0];
          const km = rota.distance.value / 1000;

          const multiplicador = MULTIPLICADOR_VEICULO[selecaoVeiculo] ?? 1;

          const parteKm = km * VALOR_POR_KM;
          const parteKmComMultiplicador = parteKm * multiplicador;

          const adicionalNoturno = emHorarioNoturno() ? ADICIONAL_NOTURNO : 0;

          const total = TARIFA_BASE + parteKmComMultiplicador + taxaSituacao + adicionalNoturno;

          const linkMinhaLocalizacao = ultimaLocalizacao
            ? `https://www.google.com/maps/search/?api=1&query=${ultimaLocalizacao.lat},${ultimaLocalizacao.lng}`
            : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(rota.start_address)}`;

          ultimoResumo = {
            origem: rota.start_address,
            destino: rota.end_address,
            distancia: rota.distance.text,
            tempo: rota.duration.text,
            preco: brl(total),
            linkMinhaLocalizacao,
            adicionalNoturno: adicionalNoturno
          };

          ultimoSnapshot = snapshotAtual();

          setResultado(`
            <b>Tipo de ve√≠culo:</b> ${selecaoVeiculo}<br>
            <b>Tipo de situa√ß√£o:</b> ${selecaoSituacao}<br><br>
            <b>Origem:</b> ${rota.start_address}<br>
            <b>Destino:</b> ${rota.end_address}<br><br>
            <b>Dist√¢ncia:</b> ${rota.distance.text}<br>
            <b>Tempo estimado:</b> ${rota.duration.text}<br><br>
            <b>Valor estimado:</b> ${brl(total)}<br>
            ${adicionalNoturno > 0 ? `<b>Adicional noturno (22h‚Äì06h):</b> ${brl(adicionalNoturno)}<br>` : ``}
            <span class="muted">
              (${brl(TARIFA_BASE)} + (${km.toFixed(2)} km √ó ${brl(VALOR_POR_KM)} √ó multiplicador ${multiplicador.toFixed(1)}) + taxa ${brl(taxaSituacao)}${adicionalNoturno > 0 ? ` + adicional noturno ${brl(adicionalNoturno)}` : ``})
            </span>
          `);

          if (abrirModalDepois) abrirModal();
        }
      );
    }

    // ‚úÖ Sempre inclui localiza√ß√£o (se dispon√≠vel)
    function montarLinkLocalizacao() {
      if (ultimaLocalizacao) {
        return `https://www.google.com/maps/search/?api=1&query=${ultimaLocalizacao.lat},${ultimaLocalizacao.lng}`;
      }

      const origem = document.getElementById("origem").value.trim();
      if (origem) {
        return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(origem)}`;
      }

      return "";
    }

    function abrirWhatsComDadosAtualizados() {
      if (!validarSelecoesOuAvisar()) return;

      const origem = document.getElementById("origem").value.trim();
      const destino = document.getElementById("destino").value.trim();
      const linkLocalizacao = montarLinkLocalizacao();

      // Sem origem/destino => conversa direta (sem modal), com localiza√ß√£o
      if (!origem || !destino) {
        let msg = `Ol√°, gostaria de fazer um or√ßamento com atendente.\n\n`;
        msg += `Ve√≠culo: ${selecaoVeiculo}\n`;
        msg += `Situa√ß√£o: ${selecaoSituacao}\n`;
        if (linkLocalizacao) msg += `\nüìç Minha localiza√ß√£o atual:\n${linkLocalizacao}\n`;

        const url = `https://wa.me/${WHATSAPP_NUMERO}?text=${encodeURIComponent(msg)}`;
        window.open(url, "_blank");
        return;
      }

      // Tem origem+destino => garante or√ßamento atualizado
      if (!ultimoResumo || mudouDesdeUltimoCalculo()) {
        setResultado("Atualizando or√ßamento‚Ä¶");
        calcularRota({ abrirModalDepois: true });
        return;
      }

      // J√° est√° calculado e atualizado => pede nome e envia estruturado
      abrirModal();
    }

    function abrirModal() {
      if (!validarSelecoesOuAvisar()) return;
      document.getElementById("nomeCliente").value = "";
      document.getElementById("modalNome").style.display = "flex";
      setTimeout(() => document.getElementById("nomeCliente").focus(), 50);
    }

    function fecharModal() {
      document.getElementById("modalNome").style.display = "none";
    }

    // ‚úÖ Com ou sem c√°lculo, sempre manda localiza√ß√£o (se existir)
    function enviarWhats() {
      const nome = document.getElementById("nomeCliente").value.trim();
      if (!nome) {
        alert("Digite seu nome.");
        return;
      }

      if (!validarSelecoesOuAvisar()) {
        alert("Selecione o Tipo de ve√≠culo e o Tipo de situa√ß√£o (obrigat√≥rio).");
        return;
      }

      const linkLocalizacao = montarLinkLocalizacao();
      let msg = "";

      if (ultimoResumo) {
        msg += `Ol√°, me chamo ${nome}.\n\n`;
        msg += `Gostaria de confirmar o atendimento de guincho conforme or√ßamento abaixo:\n\n`;
        msg += `Ve√≠culo: ${selecaoVeiculo}\n`;
        msg += `Situa√ß√£o: ${selecaoSituacao}\n`;
        msg += `Origem: ${ultimoResumo.origem}\n`;
        msg += `Destino: ${ultimoResumo.destino}\n`;
        msg += `Dist√¢ncia: ${ultimoResumo.distancia}\n`;
        msg += `Tempo estimado: ${ultimoResumo.tempo}\n`;
        if (ultimoResumo.adicionalNoturno && ultimoResumo.adicionalNoturno > 0) {
          msg += `Adicional noturno (22h‚Äì06h): ${brl(ultimoResumo.adicionalNoturno)}\n`;
        }
        msg += `Valor estimado: ${ultimoResumo.preco}\n`;

        if (linkLocalizacao) {
          msg += `\nüìç Minha localiza√ß√£o atual:\n${linkLocalizacao}\n`;
        }
      } else {
        msg += `Ol√°, me chamo ${nome}.\n\n`;
        msg += `Gostaria de fazer um or√ßamento com atendente.\n\n`;
        msg += `Ve√≠culo: ${selecaoVeiculo}\n`;
        msg += `Situa√ß√£o: ${selecaoSituacao}\n`;

        if (linkLocalizacao) {
          msg += `\nüìç Minha localiza√ß√£o atual:\n${linkLocalizacao}\n`;
        }
      }

      const url = `https://wa.me/${WHATSAPP_NUMERO}?text=${encodeURIComponent(msg)}`;
      window.open(url, "_blank");

      fecharModal();
    }
  </script>

  <!-- Google Maps JS + Places -->
  <script
    async
    defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCCNAa-Zu-wK5Bov5P1rNYgubIhrICYaM&libraries=places&callback=initMap">
  </script>
</body>
</html>
